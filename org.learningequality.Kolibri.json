{
  "app-id": "org.learningequality.Kolibri",
  "runtime": "org.gnome.Platform",
  "runtime-version": "3.34",
  "sdk": "org.gnome.Sdk",
  "finish-args": [
    "--share=network",
    "--persist=.kolibri"
  ],
  "command": "run_kolibri",
  "modules": [
    "shared-modules/dbus-glib/dbus-glib-0.110.json",
    {
      "name": "python-dbus",
      "sources": [
        {
          "type": "archive",
          "url": "https://pypi.python.org/packages/ad/1b/76adc363212c642cabbf9329457a918308c0b9b5d38ce04d541a67255174/dbus-python-1.2.4.tar.gz",
          "sha256": "e2f1d6871f74fba23652e51d10873e54f71adab0525833c19bad9e99b1b2f9cc"
        }
      ],
      "build-options": {
        "env": {
          "PYTHON": "python3.7"
        }
      }
    },
    {
      "name": "pygobject",
      "buildsystem": "simple",
      "build-commands": [
        "python3 setup.py install --prefix=/app"
      ],
      "ensure-writable": [
        "/lib/python*/site-packages/easy-install.pth"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://download.gnome.org/sources/pygobject/3.34/pygobject-3.34.0.tar.xz",
          "sha256": "87e2c9aa785f352ef111dcc5f63df9b85cf6e05e52ff04f803ffbebdacf5271a"
        }
      ],
      "cleanup": [
        "/include",
        "/lib/pkgconfig",
        "/lib/python*/site-packages/gi/*.la"
      ]
    },
    {
      "name": "kolibri",
      "buildsystem": "simple",
      "build-commands": [
        "pip3 install --prefix=/app ."
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://files.pythonhosted.org/packages/e4/7d/a2dfc584ff455fc9794c323516b9faedfc94098a0bde18a471cda0cb9559/kolibri-0.13.0.tar.gz",
          "sha256": "0889c130d37e82ce1398eb277d2e677d13f6007dcef7bc2cd023e155c2c82ffc"
        },
        {
          "type": "patch",
          "path": "patches/kolibri_heartbeat.patch"
        },
        {
          "type": "patch",
          "path": "patches/dbus_activation_service.py.patch"
        },
        {
          "type": "patch",
          "path": "patches/gnome_search_provider_service.py.patch"
        },
        {
          "type": "patch",
          "path": "patches/kolibri_remove_sanity_check_for_port_availability.patch"
        }
      ]
    },
    {
      "name": "helper_scripts",
      "buildsystem": "simple",
      "build-commands": [
        "pip3 install --prefix=/app ."
      ],
      "sources": [
        {
          "type": "dir",
          "path": "src/python-kolibri-flatpak-utils/"
        }
      ]
    },
    {
      "name": "helper_scripts_data",
      "buildsystem": "simple",
      "build-commands": [
        "install -D bin/* -t /app/bin",
        "install -D www/* -t /app/www"
      ],
      "sources": [
        {
          "type": "dir",
          "path": "src/"
        }
      ]
    },
    {
      "name": "desktop",
      "buildsystem": "simple",
      "build-commands": [
        "install -Dm644 org.learningequality.Kolibri.metainfo.xml /app/share/metainfo/org.learningequality.Kolibri.metainfo.xml",
        "install -Dm644 org.learningequality.Kolibri.desktop /app/share/applications/org.learningequality.Kolibri.desktop",
        "install -Dm644 icons/icon-64.png /app/share/icons/hicolor/64x64/apps/org.learningequality.Kolibri.png",
        "install -Dm644 icons/icon-128.png /app/share/icons/hicolor/128x128/apps/org.learningequality.Kolibri.png",
        "install -Dm644 icons/icon-256.png /app/share/icons/hicolor/256x256/apps/org.learningequality.Kolibri.png",
        "install -Dm644 icons/icon-512.png /app/share/icons/hicolor/512x512/apps/org.learningequality.Kolibri.png",
        "install -Dm644 gnome-shell/search-providers/org.learningequality.Kolibri.ini /app/share/gnome-shell/search-providers/org.learningequality.Kolibri.ini",
        "install -Dm644 dbus-1/services/org.learningequality.Kolibri.service /app/share/dbus-1/services/org.learningequality.Kolibri.service",
        "install -Dm644 dbus-1/services/org.learningequality.Kolibri.SearchProvider.service /app/share/dbus-1/services/org.learningequality.Kolibri.SearchProvider.service"
      ],
      "sources": [
        {
          "type": "dir",
          "path": "src/"
        },
        {
          "type": "file",
          "path": "org.learningequality.Kolibri.desktop"
        },
        {
          "type": "file",
          "path": "org.learningequality.Kolibri.metainfo.xml"
        }
      ]
    }
  ]
}